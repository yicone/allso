"use strict";!function(){function e(e){for(var t=window.location.search.substring(1),n=t.split("&"),s=0;s<n.length;s++){var a=n[s].split("=");if(decodeURIComponent(a[0])==e)return decodeURIComponent(a[1])}console.log("Query variable %s not found",e)}function t(){this.ENGINES=[]}var n={enginePair:["Ask","搜狗"],autoSO:!0,show_side:2,sync_mode:0};t.prototype.exists=function(e){return this.ENGINES.some(function(t){return t.name==e})},t.prototype.get=function(e){return this.ENGINES.find(function(t){return t.name==e})};var s={_state:{},_enginesConfig:new t,_set_url:[],_set_top:[0,0],_set_left:[0,0],_set_foot:[0,0],$soinput:$(".soinput"),$progress:$("div.progress>div"),$iframe:$("iframe.search_window"),$a:$("#a"),$b:$("#b"),initState:function(){if(void 0!==localStorage.allso_state){var e=localStorage.allso_state;s._state=JSON.parse(e)}s._state=$.extend({},n,s._state),console.log("launch engines:",s._state.enginePair)},resizePanel:function(){var e=$("body").width(),t=$(window).height(),n=$("nav.navbar").height(),a=e/2;2==s._state.show_side?(s.$a.fadeIn("fast").animate({"margin-left":s._set_left[0],width:a-s._set_left[0]},"fast"),s.$b.fadeIn("fast").animate({"margin-left":a+s._set_left[1],width:a-s._set_left[1]},"fast"),s.$progress[0].style.width="50%",s.$progress[1].style.width="50%"):0==s._state.show_side?(s.$a.fadeIn("fast").animate({"margin-left":s._set_left[0],width:e-s._set_left[0]},"fast"),s.$b.fadeOut("fast"),s.$progress[0].style.width="75%",s.$progress[1].style.width="25%"):(s.$a.fadeOut("fast"),s.$b.fadeIn("fast").animate({"margin-left":s._set_left[1],width:e-s._set_left[0]},"fast"),s.$progress[0].style.width="25%",s.$progress[1].style.width="75%"),s.$a.animate({"margin-top":s._set_top[0]+n,height:t-s._set_top[0]-n+s._set_foot[0]},"fast"),s.$b.animate({"margin-top":s._set_top[1]+n,height:t-s._set_top[1]-n+s._set_foot[1]},"fast")},saveState:function(){localStorage.allso_state=JSON.stringify(s._state)},onEngineSelected:function(e,t){window.electronFlag||localStorage["X-Frame-Options"]||["Google","微博","Evernote"].indexOf(t)>=0&&$("#myModal").modal("show"),s._enginesConfig.exists(t)?(s._state.enginePair[e]=t,s.saveState()):t=s._state.enginePair[e],console.log("engine_key",t);var n=s._enginesConfig.get(t);if(!n)throw new Error("no engine selected");s._set_url[e]=n.url,s._set_top[e]=n.offset.top,s._set_left[e]=n.offset.left,s._set_foot[e]=n.offset.bottom,$(".engine-brand img").eq(e).attr("src",n.logo),s.resizePanel(),s.startSearch(e)},getUrl:function(e){var t=$.trim(s.$soinput[e].value),n=s._set_url[e].replace("${k}",encodeURIComponent(t));return"Evernote"==s._state.enginePair[e]&&(n+="&"),n},doubleSearch:function(){s.$a[0].src=s.getUrl(0);var e=$(s.$soinput[0]).val();if(e){var t,n;if(1==s._state.sync_mode)t="en",n="zh-CN";else{if(2!=s._state.sync_mode)return $(s.$soinput[1]).val(e),void(s.$b[0].src=s.getUrl(1));t="zh-CN",n="en"}var a="https://romantic-bartik-04cd0f.netlify.com/.netlify/functions/gtrans?sl="+t+"&tl="+n+"&dt=t&q="+e;$.ajax({url:a,dataType:"text",success:function(e){console.log("translate result:",e),$(s.$soinput[1]).val(e),s.$b[0].src=s.getUrl(1)},error:function(t,n,a){console.error(t,n,a),$(s.$soinput[1]).val(e),s.$b[0].src=s.getUrl(1)}})}},startSearch:function(e){var t=$.trim(s.$soinput[0].value);""!=t?(void 0==e&&2==s._state.show_side&&(e=0),2!=s._state.show_side?e!=s._state.show_side?(s._state.show_side=2,s.saveState(),s.resizePanel(),s.doubleSearch()):0==e?s.$a[0].src=s.getUrl(e):(console.assert(1==e,"用例4 side should be 1",e),s.$b[0].src=s.getUrl(e)):0==e?s.doubleSearch():(console.assert(1==e,"用例2 side should be 1",e),s.$b[0].src=s.getUrl(e)),window.document.title=t+" - 虫洞搜索"):window.document.title="虫洞搜索 - 享受搜索的乐趣",s.$progress.addClass("progress-bar-striped active"),window.setTimeout(function(){s.$progress.removeClass("progress-bar-striped active")},2e3)},expandPanel:function(e){2==s._state.show_side?(s._state.show_side=e,s._set_left[e]=0):s._state.show_side=2,s.saveState(),s.resizePanel()}};$(function(){s.initState(),s.resizePanel(),$.get("https://romantic-bartik-04cd0f.netlify.com/.netlify/functions/engines-get-all",function(t){var n="string"==typeof t?JSON.parse(t):t;s._enginesConfig.ENGINES=n.sort(function(e,t){return e.group-t.group}),$(".engines").each(function(e){for(var t in s._enginesConfig.ENGINES){var n=s._enginesConfig.ENGINES[t],a=e,i=n.name;if(t-1>=0){var o=s._enginesConfig.ENGINES[t-1];n.group>o.group&&$(this).append('<li role="separator" class="divider"></li>')}var r='<li><a href="#" data-side="'+a+'" data-engine-key="'+i+'">'+i+"</a></li>";$(this).append(r)}}),$(".engines a").click(function(e){var t=$(this).attr("data-side"),n=$(this).attr("data-engine-key");s.onEngineSelected(t,n)}),window.addEventListener("resize",function(){s.resizePanel()});for(var a in s._state.enginePair){var i=s._state.enginePair[a];s.onEngineSelected(a,i),$("div.loading").fadeOut("fast")}if(location.search){var o=e("q");o&&(o=o.replace(/\+/g," ").replace(/%20/g," "),s.$soinput.val(o),s.startSearch())}}).fail(function(e){console.error("获取引擎列表错误",e)}),$($(".sync-mode>a")[s._state.sync_mode]).addClass("btn-danger"),$($(".modal-footer>button").get(1)).click(function(){localStorage["X-Frame-Options"]=!0,$("#myModal").modal("hide")}),s.$soinput.each(function(e){$(this).on("input",function(){s._state.autoSO&&s.startSearch(e)}),$(this).bind("enterKey",function(t){var n=$(this).val();location=location.origin+"?q="+n,0==e&&s.startSearch(e)}),$(this).keyup(function(e){13==e.keyCode&&$(this).trigger("enterKey")})}),$("#jdt1").click(function(){s.expandPanel(0)}),$("#jdt2").click(function(){s.expandPanel(1)}),$(".sync-mode>a").each(function(e){$(this).click({index:e},function(t){$(".sync-mode>a").removeClass("btn-danger"),$(this).addClass("btn-danger"),s._state.sync_mode=e,s.saveState(),s.startSearch()})})})}();
//# sourceMappingURL=main.js.map
